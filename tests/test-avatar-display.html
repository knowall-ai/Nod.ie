<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Avatar Display Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .test-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .test-case {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .avatar-preview {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto 10px;
            position: relative;
            background: #667eea;
        }
        
        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .status {
            margin-top: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
        }
        
        .status.success {
            background: #c6f6d5;
            color: #276749;
        }
        
        .status.error {
            background: #fed7d7;
            color: #742a2a;
        }
        
        h1 {
            color: #667eea;
        }
    </style>
</head>
<body>
    <h1>Nod.ie Avatar Display Test</h1>
    
    <div class="test-container">
        <div class="test-case">
            <h3>Static Avatar</h3>
            <div class="avatar-preview">
                <img src="../assets/avatars/nodie-default.png" alt="Nod.ie Avatar" id="static-avatar">
            </div>
            <div class="status" id="static-status">Loading...</div>
        </div>
        
        <div class="test-case">
            <h3>MuseTalk Status</h3>
            <div class="avatar-preview" style="display: flex; align-items: center; justify-content: center; color: white;">
                <div id="musetalk-info">Checking...</div>
            </div>
            <div class="status" id="musetalk-status">Loading...</div>
        </div>
    </div>
    
    <script>
        // Test static avatar loading
        const staticImg = document.getElementById('static-avatar');
        const staticStatus = document.getElementById('static-status');
        
        staticImg.onload = () => {
            staticStatus.textContent = 'Avatar loaded successfully';
            staticStatus.className = 'status success';
        };
        
        staticImg.onerror = () => {
            staticStatus.textContent = 'Failed to load avatar image';
            staticStatus.className = 'status error';
        };
        
        // Test MuseTalk connection
        async function checkMuseTalk() {
            const musetalkInfo = document.getElementById('musetalk-info');
            const musetalkStatus = document.getElementById('musetalk-status');
            
            try {
                const response = await fetch('http://localhost:8765/health');
                const data = await response.json();
                
                musetalkInfo.innerHTML = `
                    <div>Status: ${data.status}</div>
                    <div>Model: ${data.model_loaded ? 'Loaded' : 'Not loaded'}</div>
                    <div>Device: ${data.device}</div>
                `;
                
                musetalkStatus.textContent = 'MuseTalk service is running';
                musetalkStatus.className = 'status success';
            } catch (error) {
                musetalkInfo.innerHTML = `
                    <div>Service not available</div>
                    <div style="font-size: 12px; margin-top: 10px;">Falling back to static avatar</div>
                `;
                
                musetalkStatus.textContent = 'MuseTalk service not running';
                musetalkStatus.className = 'status error';
            }
        }
        
        // Run tests
        checkMuseTalk();
    </script>
</body>
</html>