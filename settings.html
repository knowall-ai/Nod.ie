<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Nod.ie Settings</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #667eea;
        }
        
        .section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            font-size: 18px;
            margin-top: 0;
            margin-bottom: 15px;
            color: #444;
        }
        
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .setting-row:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .setting-label {
            flex: 1;
        }
        
        .setting-label h3 {
            margin: 0 0 5px 0;
            font-size: 14px;
            font-weight: 600;
        }
        
        .setting-label p {
            margin: 0;
            font-size: 12px;
            color: #666;
        }
        
        input[type="checkbox"] {
            width: 40px;
            height: 20px;
            -webkit-appearance: none;
            appearance: none;
            background: #ccc;
            border-radius: 20px;
            outline: none;
            cursor: pointer;
            transition: background 0.3s;
            position: relative;
        }
        
        input[type="checkbox"]:checked {
            background: #667eea;
        }
        
        input[type="checkbox"]::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }
        
        input[type="checkbox"]:checked::before {
            transform: translateX(20px);
        }
        
        input[type="text"], input[type="url"], select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            min-width: 200px;
            background: white;
        }
        
        select {
            cursor: pointer;
        }
        
        .button-row {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        
        .avatar-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .status-available {
            background: #c6f6d5;
            color: #276749;
        }
        
        .status-unavailable {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .status-static {
            background: #fefcbf;
            color: #744210;
        }
    </style>
</head>
<body>
    <h1>Nod.ie Settings</h1>
    
    <div class="section">
        <h2>Avatar Settings</h2>
        
        <div class="setting-row">
            <div class="setting-label">
                <h3>Show Avatar</h3>
                <p>Display animated avatar with lip-sync when speaking</p>
            </div>
            <input type="checkbox" id="avatarEnabled">
        </div>
        
        <div class="setting-row">
            <div class="setting-label">
                <h3>Avatar Quality</h3>
                <p>Higher quality requires more resources</p>
            </div>
            <select id="avatarQuality">
                <option value="auto">Auto</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
            </select>
        </div>
        
        <div class="setting-row">
            <div class="setting-label">
                <h3>Avatar Status</h3>
                <p>Current avatar system status</p>
            </div>
            <div id="avatarStatus" class="avatar-status">Checking...</div>
        </div>
    </div>
    
    <div class="section">
        <h2>Connection Settings</h2>
        
        <div class="setting-row">
            <div class="setting-label">
                <h3>Assistant Name</h3>
                <p>Name used in N8N webhooks</p>
            </div>
            <input type="text" id="assistantName" placeholder="Nod.ie">
        </div>
        
        <div class="setting-row">
            <div class="setting-label">
                <h3>Unmute Frontend URL</h3>
                <p>WebSocket URL for Unmute</p>
            </div>
            <input type="url" id="unmuteFrontendUrl" placeholder="ws://localhost:3000">
        </div>
        
        <div class="setting-row">
            <div class="setting-label">
                <h3>Voice Model</h3>
                <p>Voice to use for speech synthesis</p>
            </div>
            <select id="voiceModel">
                <option value="nova">Nova</option>
                <option value="echo">Echo</option>
                <option value="fable">Fable</option>
                <option value="onyx">Onyx</option>
                <option value="alloy">Alloy</option>
                <option value="shimmer">Shimmer</option>
            </select>
        </div>
    </div>
    
    <div class="section">
        <h2>Keyboard Shortcuts</h2>
        
        <div class="setting-row">
            <div class="setting-label">
                <h3>Global Hotkey</h3>
                <p>Keyboard shortcut to toggle Nod.ie</p>
            </div>
            <input type="text" id="globalHotkey" placeholder="CommandOrControl+Shift+Space">
        </div>
    </div>
    
    <div class="button-row">
        <button class="btn-secondary" onclick="cancelSettings()">Cancel</button>
        <button class="btn-primary" onclick="saveSettings()">Save</button>
    </div>
    
    <script>
        const { ipcRenderer } = require('electron');
        const Store = require('electron-store');
        const store = new Store();
        
        // Load current settings
        function loadSettings() {
            document.getElementById('avatarEnabled').checked = store.get('avatarEnabled', true);
            document.getElementById('avatarQuality').value = store.get('avatarQuality', 'auto');
            document.getElementById('assistantName').value = store.get('assistantName', 'Nod.ie');
            document.getElementById('unmuteFrontendUrl').value = store.get('unmuteFrontendUrl', 'ws://localhost:3000');
            document.getElementById('voiceModel').value = store.get('voiceModel', 'nova');
            document.getElementById('globalHotkey').value = store.get('globalHotkey', 'CommandOrControl+Shift+Space');
            
            // Check avatar status
            checkAvatarStatus();
        }
        
        async function checkAvatarStatus() {
            try {
                const response = await fetch('http://localhost:8767/health');
                const health = await response.json();
                
                const statusEl = document.getElementById('avatarStatus');
                if (health.status === 'healthy') {
                    statusEl.textContent = 'Available';
                    statusEl.className = 'avatar-status status-available';
                } else {
                    statusEl.textContent = 'Static Mode';
                    statusEl.className = 'avatar-status status-static';
                }
            } catch (error) {
                const statusEl = document.getElementById('avatarStatus');
                statusEl.textContent = 'Unavailable';
                statusEl.className = 'avatar-status status-unavailable';
            }
        }
        
        function saveSettings() {
            // Save all settings
            store.set('avatarEnabled', document.getElementById('avatarEnabled').checked);
            store.set('avatarQuality', document.getElementById('avatarQuality').value);
            store.set('assistantName', document.getElementById('assistantName').value);
            store.set('unmuteFrontendUrl', document.getElementById('unmuteFrontendUrl').value);
            store.set('voiceModel', document.getElementById('voiceModel').value);
            store.set('globalHotkey', document.getElementById('globalHotkey').value);
            
            // Notify main process to update settings
            ipcRenderer.send('settings-updated', {
                avatarEnabled: document.getElementById('avatarEnabled').checked
            });
            
            // Close window
            window.close();
        }
        
        function cancelSettings() {
            window.close();
        }
        
        // Load settings on startup
        loadSettings();
    </script>
</body>
</html>